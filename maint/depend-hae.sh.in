#!/bin/sh
DIR="$1"
shift
SRCDIR="$1"
shift
if [ -n "$DIR" ] ; then
    DIR="$DIR"/
fi

CC="@CC@"
# Explanation of some arguments:
# -MG tells gcc to ignore errors from missing header files, which is
#   important in Triton because some of them are autogenerated and won't exist
#   yet when we run this tool.
# -MM tells gcc not to bother including system header files.  Our
#   build is slow enough already so it isn't worth it.
# -x c tells gcc to pretend like the input file is a c file regardless of
#   filename extension.  This is useful for cases where we want gcc to
#   generate dependencies on raw .ae files.
# there is one manual addition to the dependencies (ae-blocking-parser.h)
#   which is implicitly added by the aesop parser
exec $CC -x c -M -MM -MG "$@" | sed -e "s@^\(.*\)\.o:@$DIR\1.h: $SRCDIR/ae-blocking-parser.h@"
